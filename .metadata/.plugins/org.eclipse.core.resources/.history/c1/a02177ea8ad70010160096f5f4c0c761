<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mediverse - My Prescriptions</title>
    <link rel="stylesheet" href="<c:url value='/css/userhome.css'/>">
    <style>
        /* Specific styles for the prescriptions section to look like the orders page */
        .prescriptions {
            padding: 30px;
            max-width: 900px;
            margin: 20px auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            
            /* The flex: 1 property from userhome.css is necessary here 
               to push the footer down if the content is short.
               It is assumed that this block is now styled by the updated 
               userhome.css where necessary. */
        }
        .prescriptions h2 {
            text-align: center;
            color: #4CAF50; /* Green heading from userhome.css */
            margin-bottom: 30px;
        }
        .action-bar {
            margin-bottom: 25px;
            text-align: right; /* Align the Add button to the right */
        }
        .prescription-card {
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        .prescription-card h3 {
            margin-top: 0;
            /* Use a lighter color for the card heading border */
            border-bottom: 2px solid #6c757d; 
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: #343a40;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .prescription-card h3 span {
            font-size: 14px;
            font-weight: normal;
            color: #4CAF50; /* Green for date */
        }
        .prescription-card p {
            margin: 5px 0;
            line-height: 1.5;
        }
        /* Button styles copied from Order page */
        .btn {
            display: inline-block;
            padding: 8px 15px;
            margin-left: 10px;
            font-size: 14px;
            text-decoration: none;
            color: white;
            border-radius: 4px;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
            margin-top: 10px; /* Added margin-top for card actions */
        }
        
        .btn-add {
            background-color: #28a745; /* Success Green */
        }
        .btn-add:hover {
            background-color: #1e7e34;
        }

        .btn-delete {
            background-color: #dc3545; /* Danger Red */
        }
        .btn-delete:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">
            <a href="/user/home">Mediverse</a>
        </div>
        <ul>
            <li><a href="/user/home">Home</a></li>
            <li><a href="/user/profile">Profile</a></li>
            <li><a href="/user/order">Orders</a></li>
            <li><a href="/user/prescriptions">Prescriptions</a></li>
            <li><a href="/logout">Logout</a></li>
        </ul>
    </nav>

    <section class="prescriptions">
        <h2>Your Prescriptions</h2>

        <div class="action-bar">
            <a href="/user/addPrescription" class="btn btn-add">Add New Prescription</a>
        </div>
        
        <c:choose>
            <c:when test="${not empty prescriptions}">
                <c:forEach var="prescription" items="${prescriptions}">
                    <div class="prescription-card">
                        <h3>
                            Prescription ID: ${prescription.prescriptionId} 
                            <span>Date: ${prescription.prescriptionDate}</span>
                        </h3>
                        <p><strong>Medicine Name:</strong> ${prescription.medicine.name}</p>
                        <p><strong>Dosage:</strong> ${prescription.dosage}</p>
                        <p><strong>Instructions:</strong> ${prescription.instructions}</p>
                        
                        <div class="prescription-actions">
                            <a href="/user/deletePrescription/${prescription.prescriptionId}" class="btn btn-delete"
                               onclick="return confirm('Are you sure you want to delete this prescription?');">
                                Delete Prescription
                            </a>
                            <a href="/user/buyMedicine/${prescription.medicine.medicineId}" class="btn btn-add">Buy Medicine</a>
                        </div>
                    </div>
                </c:forEach>
            </c:when>
            <c:otherwise>
                <p style="text-align: center; color: #6c757d; padding: 20px; background-color: #f4f7f6; border-radius: 4px;">
                    You have no recorded prescriptions yet. Click "Add New Prescription" to get started.
                </p>
            </c:otherwise>
        </c:choose>
    </section>

    <footer>
        <p>&copy; 2025 Mediverse. All rights reserved.</p>
    </footer>

</body>
</html>